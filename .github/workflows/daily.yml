name: Daily Contribution

permissions:
  contents: write   # Required to let GITHUB_TOKEN push commits

on:
  schedule:
    # 07:00 UTC = ~12:30 PM IST — good safe time
    - cron: '0 7 * * *'
  workflow_dispatch:   # Lets you trigger manually from the Actions tab if you want

jobs:
  auto-contribute:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4   # ← Updated to latest version (v4 is current in 2026)
        with:
          # No need for persist-credentials: true anymore in v4 — it handles auth better internally

      - name: Random delay (0–2 hours) to look more natural
        run: sleep $((RANDOM % 7200 + 1))   # +1 avoids exactly 0 sec

      - name: Make daily commit (in IST timezone)
        run: |
          # Set timezone so date shows IST correctly in commit message
          export TZ=Asia/Kolkata

          # Append a line with current IST time — keeps file changing
          echo "Daily auto update: $(date '+%Y-%m-%d %H:%M:%S %Z')" >> log.txt

          git config user.name "NABORAJ SARAKR"
          git config user.email "nishant.ns.business@gmail.com"

          git add log.txt
          # Only commit if there are changes (prevents empty commit errors)
          git diff --staged --quiet || git commit -m "chore: daily contribution $(date '+%Y-%m-%d')"

          # Push — GITHUB_TOKEN has write permission from the permissions: block
          git push origin HEAD
